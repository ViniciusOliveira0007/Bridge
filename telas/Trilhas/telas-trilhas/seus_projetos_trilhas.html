<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Trilhas</title>
    <link rel="stylesheet" href="../estilos_trilhas/estilo_seus_projetos.css">
</head>
<body>

    <nav class="navegacao">
        <div class="menu">
            <div class="menu-1">
                <img src="../imagens_trilhas/lotus.svg" alt="Logo da institui√ß√£o" class="projeto" width="30px" height="30px">
            </div>
            <div class="menu-2">
                <input type="text" placeholder="Pesquise aqui...">
            </div> 
            <div class="menu-3">
                <img src="../imagens_trilhas/sininho.svg" alt="notifica√ß√£o" class="btn-notificao-nav">
                <img src="../imagens_trilhas/configuracao.svg" alt="bot√£o de configura√ß√£o" class="btn-config">
                <img src="../imagens_trilhas/foto_de_perfil.png" alt="imagem de perfil" class="foto-de-perfil" id="fotoPerfilNav">
                
                <div class="dropdown-notificacoes" id="dropdownNotif">
                    <div class="dropdown-header">
                        <div class="dropdown-titulo">
                            <img src="../imagens_trilhas/sino-black.svg" alt="Notifica√ß√£o">
                            <span>Notifica√ß√µes</span>
                        </div>
                        <button class="btn-fechar" data-action="fechar-notif">&times;</button>
                    </div>
                    <div class="dropdown-opcoes">
                        <div class="notificacao-vazia">Nenhuma notifica√ß√£o no momento</div>
                    </div>
                </div>

                <div class="dropdown-configuracoes" id="dropdownConfig">
                    <div class="dropdown-header">
                        <div class="dropdown-titulo">
                            <img src="../imagens_trilhas/configuracao-black.svg" alt="Configura√ß√£o">
                            <span>Configura√ß√µes</span>
                        </div>
                        <button class="btn-fechar" data-action="fechar-config">&times;</button>
                    </div>
                    <div class="dropdown-opcoes">
                        <button class="opcao-item" data-action="abrir-tema">Tema</button>
                        <button class="opcao-item" data-action="abrir-acessibilidade">Acessibilidade</button>
                        <button class="opcao-item" data-action="abrir-opcoes-avancadas">Op√ß√µes avan√ßadas</button>
                    </div>
                </div>

                <div class="dropdown-perfil" id="dropdownPerfil">
                    <div class="dropdown-header">
                        <div class="dropdown-titulo">
                            <img src="../../imagens_trilhas/foto_de_perfil.png" alt="Perfil" class="perfil-mini" id="fotoPerfilMini">
                            <span id="nomeUsuarioPerfil">Ol√°, Usu√°rio</span>
                        </div>
                        <button class="btn-fechar" data-action="fechar-perfil">&times;</button>
                    </div>
                    <div class="dropdown-opcoes">
                        <button class="opcao-item" data-action="abrir-seu-perfil">Seu perfil</button>
                        <button class="opcao-item" data-action="abrir-privacidade">Privacidade</button>
                        <button class="opcao-item" data-action="abrir-ajuda-recursos">Ajuda e Recursos</button>
                        <button class="opcao-item sair-conta" data-action="sair-da-conta">Sair da Conta</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="nome-da-guia">
        <ul>
            <li><a href="../../Rede/connect.html">Redes</a></li>
            <li><a href="../../Sala-de-Aula/sala.html">Sala de Aula</a></li>
            <li><a href="../../Trilhas/trilhas.html">Trilhas</a></li>
            <li><a href="../../Diario/diario.html">Di√°rio</a></li>
        </ul>
    </div>

    <main class="conteudo-principal"> 
        <div class="empresas">
            <div class="perfil-trilhas">
                <div class="box-perfil">
                   <img src="../imagens_trilhas/foto_de_perfil.png" alt="sua foto de perfil" class="img-perfil">
                    <div class="botoes-perfil">
                        <a href="../trilhas.html" class="btn-trilhas-perfil">Explorar <img src="../imagens_trilhas/home-icon-trilhas.svg" alt="Explorar"></a>    
                        <a href="./perfil_trilhas.html" class="btn-trilhas-perfil">Seu perfil <img src="../imagens_trilhas/seu-perfil-trilhas.svg" alt="portifolio"></a>    
                        <a href="./portifolio_trilhas.html" class="btn-trilhas-perfil">Portif√≥lio<img src="../imagens_trilhas/portifolio-perfil-trilhas.svg" alt="seus projetos"></a>    
                        <a href="" class="btn-trilhas-perfil">Propostas<img src="../imagens_trilhas/projetos-aceitos-trilhas.svg" alt="projetos aceitos"></a>    
                    </div>
                </div>
            </div>
            <h3 class="h3-proposta">Sugest√µes de Propostas</h3>
            <div class="secao-propostas">
                <a href="#" class="btn-proposta">
                    <div class="box-propostas-projeto">
                            <img src="../imagens_trilhas/img-empresas/meta.svg" alt="Projeto Pendente Google" class="proposta">
                        <div class="content-desc-proposta-projeto">
                            <h4 class="desc-projeto">
                                Nova identidade visual.
                            </h4>
                        </div>
                    </div>
                </a>
                <a href="#" class="btn-proposta">
                    <div class="box-propostas-projeto">
                            <img src="../imagens_trilhas/img-empresas/amazon.svg" alt="Projeto Pendente Google" class="proposta">
                        <div class="content-desc-proposta-projeto">
                            <h4 class="desc-projeto">
                                Sistema autonomo de IA.
                            </h4>
                        </div>
                    </div>
                </a>
                <a href="#" class="btn-proposta">
                    <div class="box-propostas-projeto">
                            <img src="../imagens_trilhas/img-empresas/google.svg" alt="Projeto Pendente Google" class="proposta">
                        <div class="content-desc-proposta-projeto">
                            <h4 class="desc-projeto">
                                Tabela Excel, contabilidade e gerenciamento de informa√ß√µes
                            </h4>
                        </div>
                    </div>
                </a>

                <a href="" class="btn-trilhas-proposta">Filtrar Propostas</a> 
            </div>
        </div>
        <div class="seus-projetos">
            <div class="container-seus-projetos">
                <div class="box-seus-projetos">
                    <div class="content-trilhas-seus-projetos">
                        <div class="info-portifolio-trilhas">
                            <div class="conteudo-portifolio-trilhas">
                                <div class="botoes-perfil-trilhas">
                                    <a href="" class="btn-trilhas">Salvar Projeto <img src="../imagens_trilhas/icon-salvar.svg" alt="editar perfil"></a>
                                    <a href="" class="btn-trilhas">Editar Projeto <img src="../imagens_trilhas/edit-icon-perfil.svg" alt="editar perfil"></a>
                                </div>
                            </div>
                            <div class="portifolio">
                                <div class="seu-portifolio-trilhas">
                                    <h3 class="h3-seu-portifolio">Meus Projetos</h3>
                                    <div class="secao-seu-portifolio">
                                        <div class="card-portifolio">
                                            <div class="img-do-portifolio">
                                                <img src="../imagens_trilhas/img-Portifolio/imgPortifolio3.jpeg" alt="" class="img-portifolio">
                                            </div>
                                            <div class="content-projeto">
                                                <div class="header-projeto">
                                                    <h3 class="titulo-projeto">Logotipos entregues</h3>
                                                    <p class="data-projeto">Data: 20/11/2025</p>
                                                </div>
                                                <div class="box-projeto">
                                                    <div class="secao-habilidade-projeto">
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/PHOTOSHOP.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Photoshop</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/ILLUSTRATOR.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Illustrator</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/FIGMA.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Figma</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>                                                
                                                    </div>
                                                </div>
                                                <div class="empresa-entregue">
                                                    <img src="../imagens_trilhas/img-empresas/meta.svg" alt="" class="img-empresa">
                                                    <h3 class="h3-nm-empresa">
                                                        Meta
                                                    </h3>
                                                </div>
                                            </div>
                                        </div>   


                                        <div class="card-portifolio">
                                            <div class="img-do-portifolio">
                                                <img src="../imagens_trilhas/img-Portifolio/imgPortifolio8.jpeg" alt="" class="img-portifolio">
                                            </div>
                                            <div class="content-projeto">
                                                <div class="header-projeto">
                                                    <h3 class="titulo-projeto">Logotipos entregues</h3>
                                                    <p class="data-projeto">Data: 20/11/2025</p>
                                                </div>
                                                <div class="box-projeto">
                                                    <div class="secao-habilidade-projeto">
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/PHOTOSHOP.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Photoshop</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/ILLUSTRATOR.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Illustrator</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/FIGMA.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Figma</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>                                                
                                                    </div>
                                                </div>
                                                <div class="empresa-entregue">
                                                    <img src="../imagens_trilhas/img-empresas/google.svg" alt="" class="img-empresa">
                                                    <h3 class="h3-nm-empresa">
                                                        Google
                                                    </h3>
                                                </div>
                                            </div>
                                        </div> 
                                        
                                        
                                        <div class="card-portifolio">
                                            <div class="img-do-portifolio">
                                                <img src="../imagens_trilhas/img-Portifolio/imgPortifolio6.jpg" alt="" class="img-portifolio">
                                            </div>
                                            <div class="content-projeto">
                                                <div class="header-projeto">
                                                    <h3 class="titulo-projeto">Logotipos entregues</h3>
                                                    <p class="data-projeto">Data: 20/11/2025</p>
                                                </div>
                                                <div class="box-projeto">
                                                    <div class="secao-habilidade-projeto">
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/PHOTOSHOP.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Photoshop</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/ILLUSTRATOR.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Illustrator</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-habilidade">
                                                            <div class="img-sua-habilidade">
                                                                <img src="../imagens_trilhas/icone-habilidades-trilhas/FIGMA.svg" alt="" class="img-habilidade">
                                                            </div>
                                                            <div class="box-nm-nivel">
                                                                <div class="nome-nivel">
                                                                    <div class="espaco-nome-habilidade">
                                                                        <p class="nome-habilidade">Figma</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>                                                
                                                    </div>
                                                </div>
                                                <div class="empresa-entregue">
                                                    <img src="../imagens_trilhas/img-empresas/google.svg" alt="" class="img-empresa">
                                                    <h3 class="h3-nm-empresa">
                                                        Google
                                                    </h3>
                                                </div>
                                            </div>
                                        </div>   
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
      const API_URL = 'http://localhost:3000/api';

document.addEventListener('DOMContentLoaded', async function() {
    
    const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
    
    if (!usuarioLogado || !usuarioLogado.id) {
        alert('Voc√™ precisa fazer login primeiro!');
        window.location.href = '/home.html';
        return;
    }

    console.log('üë§ Usu√°rio logado:', usuarioLogado);

    // ============================================
    // FUN√á√ïES DE ATUALIZA√á√ÉO DE FOTOS
    // ============================================
    function atualizarTodasFotosPerfil(fotoUrl) {
        const URL_PADRAO = '../imagens_trilhas/foto_de_perfil.png';
        const urlCompleta = fotoUrl 
            ? (fotoUrl.startsWith('http') ? fotoUrl : `http://localhost:3000${fotoUrl}`)
            : URL_PADRAO;
        
        const elementos = [
            document.getElementById('fotoPerfilNav'),
            document.getElementById('fotoPerfilMini'),
            document.querySelector('.img-perfil')
        ];
        
        elementos.forEach(el => {
            if (el) {
                el.src = urlCompleta;
                el.onerror = () => el.src = URL_PADRAO;
            }
        });
    }

    async function carregarDadosUsuario() {
        try {
            const response = await fetch(`${API_URL}/users/${usuarioLogado.id}`);
            const data = await response.json();
            
            if (data.success && data.user) {
                const usuarioAtualizado = {
                    ...usuarioLogado,
                    name: data.user.name,
                    perfilUrl: data.user.perfilUrl
                };
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioAtualizado));
                
                document.getElementById('nomeUsuarioPerfil').textContent = `Ol√°, ${data.user.name || 'Usu√°rio'}`;
                
                if (data.user.perfilUrl) {
                    atualizarTodasFotosPerfil(data.user.perfilUrl);
                }
            }
        } catch (error) {
            console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
        }
    }

    await carregarDadosUsuario();

    // ============================================
    // CARREGAR CANDIDATURAS (PROJETOS ACEITOS)
    // ============================================
    async function carregarMeusProjetos() {
        try {
            console.log('üì• Carregando projetos aceitos...');
            
            const response = await fetch(`${API_URL}/trilhas/candidaturas/usuario/${usuarioLogado.id}`);
            const data = await response.json();
            
            if (data.success && data.candidaturas) {
                console.log(`‚úÖ ${data.candidaturas.length} projetos encontrados`);
                renderizarProjetos(data.candidaturas);
            }
        } catch (error) {
            console.error('‚ùå Erro ao carregar projetos:', error);
        }
    }

    function renderizarProjetos(candidaturas) {
        const container = document.querySelector('.secao-seu-portifolio');
        if (!container) return;

        // Limpar projetos est√°ticos
        container.innerHTML = '';

        if (candidaturas.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #999;">
                    <p>Voc√™ ainda n√£o aceitou nenhum projeto</p>
                    <p style="font-size: 14px;">V√° para a p√°gina "Explorar" para ver projetos dispon√≠veis</p>
                    <a href="../trilhas.html" style="display: inline-block; margin-top: 20px; padding: 10px 20px; background: #4285f4; color: white; text-decoration: none; border-radius: 8px;">Ver Projetos</a>
                </div>
            `;
            return;
        }

        candidaturas.forEach(candidatura => {
            const projeto = candidatura.projeto;
            const empresa = projeto.empresa;
            const dataAceite = new Date(candidatura.createdAt).toLocaleDateString('pt-BR');
            
            const statusClass = {
                'Aceito': 'status-aceito',
                'Em Andamento': 'status-andamento',
                'Conclu√≠do': 'status-concluido'
            }[candidatura.status] || 'status-aceito';

            const statusEmoji = {
                'Aceito': '‚úÖ',
                'Em Andamento': 'üîÑ',
                'Conclu√≠do': 'üéâ'
            }[candidatura.status] || '‚úÖ';
            
            const cardHTML = `
                <div class="card-portifolio" data-candidatura-id="${candidatura.id}">
                    <div class="img-do-portifolio">
                        <img src="${projeto.imagemUrl || '../imagens_trilhas/img-Portifolio/default.jpg'}" 
                             alt="${projeto.nome}" 
                             class="img-portifolio">
                    </div>
                    <div class="content-projeto">
                        <div class="header-projeto">
                            <h3 class="titulo-projeto">${projeto.nome}</h3>
                            <p class="data-projeto">Aceito em: ${dataAceite}</p>
                            <div class="${statusClass}" style="display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 12px; margin-top: 5px;">
                                ${statusEmoji} ${candidatura.status}
                            </div>
                        </div>
                        
                        <div class="box-projeto">
                            <p style="color: #bbb; margin: 10px 0;">${projeto.descricao || 'Sem descri√ß√£o'}</p>
                            
                            <div class="secao-habilidade-projeto">
                                <h4 style="color: white; font-size: 14px; margin: 10px 0;">Habilidades usadas:</h4>
                                ${projeto.habilidadesRequeridas?.map(hr => `
                                    <div class="card-habilidade" style="display: inline-block; margin: 5px;">
                                        <div class="img-sua-habilidade">
                                            <img src="../imagens_trilhas/icone-habilidades-trilhas/${hr.habilidade.icone || 'default.svg'}" 
                                                 alt="${hr.habilidade.nome}" 
                                                 class="img-habilidade"
                                                 style="width: 30px; height: 30px;">
                                        </div>
                                        <div class="box-nm-nivel">
                                            <div class="nome-nivel">
                                                <p class="nome-habilidade" style="font-size: 12px;">${hr.habilidade.nome}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('') || '<p style="color: #999;">Nenhuma habilidade espec√≠fica</p>'}
                            </div>
                        </div>
                        
                        <div class="empresa-entregue">
                            <img src="${empresa.logoUrl || '../imagens_trilhas/img-empresas/default.svg'}" 
                                 alt="${empresa.user.name}" 
                                 class="img-empresa"
                                 style="width: 40px; height: 40px; border-radius: 8px;">
                            <div>
                                <h3 class="h3-nm-empresa">${empresa.user.name}</h3>
                                <p style="font-size: 12px; color: #999;">${projeto.categoria || 'Projeto'}</p>
                            </div>
                        </div>

                        ${candidatura.status !== 'Conclu√≠do' ? `
                            <div style="margin-top: 15px; text-align: center;">
                                <button class="btn-marcar-concluido" 
                                        data-candidatura-id="${candidatura.id}"
                                        style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">
                                    ‚úì Marcar como Conclu√≠do
                                </button>
                            </div>
                        ` : candidatura.avaliacoes && candidatura.avaliacoes.length > 0 ? `
                            <div style="margin-top: 15px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; border-left: 4px solid #4CAF50;">
                                <p style="color: #4CAF50; font-weight: bold; margin-bottom: 5px;">‚≠ê Projeto Avaliado</p>
                                <p style="color: #ddd; font-size: 14px;">Nota: ${candidatura.avaliacoes[0].nota}/5</p>
                                <p style="color: #999; font-size: 12px; margin-top: 5px;">+${candidatura.avaliacoes[0].xpConcedido} XP ganhos</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', cardHTML);
        });

        // Adicionar event listeners para bot√µes de marcar como conclu√≠do
        document.querySelectorAll('.btn-marcar-concluido').forEach(btn => {
            btn.addEventListener('click', async function() {
                const candidaturaId = this.dataset.candidaturaId;
                await marcarComoConcluido(candidaturaId);
            });
        });
    }

    // ============================================
    // MARCAR PROJETO COMO CONCLU√çDO
    // ============================================
    async function marcarComoConcluido(candidaturaId) {
        if (!confirm('Tem certeza que concluiu este projeto?')) {
            return;
        }

        try {
            // Como n√£o temos endpoint espec√≠fico, vamos simular localmente
            // Em produ√ß√£o, criar endpoint: PUT /api/trilhas/candidaturas/:id
            
            const card = document.querySelector(`[data-candidatura-id="${candidaturaId}"]`);
            if (card) {
                // Atualizar visualmente
                const statusDiv = card.querySelector('[class*="status-"]');
                if (statusDiv) {
                    statusDiv.className = 'status-concluido';
                    statusDiv.innerHTML = 'üéâ Conclu√≠do';
                }

                // Remover bot√£o
                const btn = card.querySelector('.btn-marcar-concluido');
                if (btn) {
                    btn.remove();
                }

                // Adicionar mensagem de aguardando avalia√ß√£o
                const contentProjeto = card.querySelector('.content-projeto');
                if (contentProjeto) {
                    const avisoHTML = `
                        <div style="margin-top: 15px; padding: 15px; background: rgba(66, 133, 244, 0.1); border-radius: 8px; border-left: 4px solid #4285f4;">
                            <p style="color: #4285f4; font-weight: bold; margin-bottom: 5px;">‚è≥ Aguardando Avalia√ß√£o</p>
                            <p style="color: #ddd; font-size: 14px;">A empresa ir√° avaliar seu trabalho em breve</p>
                        </div>
                    `;
                    contentProjeto.insertAdjacentHTML('beforeend', avisoHTML);
                }

                alert('‚úÖ Projeto marcado como conclu√≠do! Aguarde a avalia√ß√£o da empresa.');
                
                // TODO: Em produ√ß√£o, fazer requisi√ß√£o real:
                // const response = await fetch(`${API_URL}/trilhas/candidaturas/${candidaturaId}`, {
                //     method: 'PUT',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ status: 'Conclu√≠do' })
                // });
            }
        } catch (error) {
            console.error('‚ùå Erro ao marcar como conclu√≠do:', error);
            alert('Erro ao atualizar status do projeto');
        }
    }

    await carregarMeusProjetos();

    // ============================================
    // ESTAT√çSTICAS DE PROJETOS
    // ============================================
    async function exibirEstatisticas() {
        try {
            const response = await fetch(`${API_URL}/trilhas/candidaturas/usuario/${usuarioLogado.id}`);
            const data = await response.json();
            
            if (data.success && data.candidaturas) {
                const total = data.candidaturas.length;
                const concluidos = data.candidaturas.filter(c => c.status === 'Conclu√≠do').length;
                const emAndamento = data.candidaturas.filter(c => c.status === 'Em Andamento').length;
                
                // Calcular XP total das avalia√ß√µes
                let xpTotal = 0;
                data.candidaturas.forEach(c => {
                    if (c.avaliacoes && c.avaliacoes.length > 0) {
                        xpTotal += c.avaliacoes.reduce((sum, av) => sum + av.xpConcedido, 0);
                    }
                });

                // Adicionar painel de estat√≠sticas
                const estatisticasHTML = `
                    <div class="estatisticas-projetos" style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="text-align: center;">
                            <p style="font-size: 32px; font-weight: bold; color: #4285f4;">${total}</p>
                            <p style="color: #999; font-size: 14px;">Total de Projetos</p>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-size: 32px; font-weight: bold; color: #FFA500;">${emAndamento}</p>
                            <p style="color: #999; font-size: 14px;">Em Andamento</p>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-size: 32px; font-weight: bold; color: #4CAF50;">${concluidos}</p>
                            <p style="color: #999; font-size: 14px;">Conclu√≠dos</p>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-size: 32px; font-weight: bold; color: #FFD700;">${xpTotal}</p>
                            <p style="color: #999; font-size: 14px;">XP Total Ganho</p>
                        </div>
                    </div>
                `;

                const containerPrincipal = document.querySelector('.seu-portifolio-trilhas');
                if (containerPrincipal) {
                    containerPrincipal.insertAdjacentHTML('afterbegin', estatisticasHTML);
                }
            }
        } catch (error) {
            console.error('‚ùå Erro ao exibir estat√≠sticas:', error);
        }
    }

    await exibirEstatisticas();

    // ============================================
    // DROPDOWNS (mantido)
    // ============================================
    const dropdownNotif = document.getElementById('dropdownNotif');
    const dropdownConfig = document.getElementById('dropdownConfig');
    const dropdownPerfil = document.getElementById('dropdownPerfil');
    const btnNotif = document.querySelector('.btn-notificao-nav');
    const btnConfig = document.querySelector('.btn-config');
    const fotoPerfilNav = document.getElementById('fotoPerfilNav');
    
    function fecharDropdownNotif() { dropdownNotif.classList.remove('ativo'); }
    function fecharDropdownConfig() { dropdownConfig.classList.remove('ativo'); }
    function fecharDropdownPerfil() { dropdownPerfil.classList.remove('ativo'); }
    
    btnNotif.addEventListener('click', () => {
        fecharDropdownConfig();
        fecharDropdownPerfil();
        dropdownNotif.classList.toggle('ativo');
    });
    
    btnConfig.addEventListener('click', () => {
        fecharDropdownNotif();
        fecharDropdownPerfil();
        dropdownConfig.classList.toggle('ativo');
    });
    
    fotoPerfilNav.addEventListener('click', () => {
        fecharDropdownNotif();
        fecharDropdownConfig();
        dropdownPerfil.classList.toggle('ativo');
    });

    document.querySelectorAll('[data-action]').forEach(btn => {
        btn.addEventListener('click', function() {
            const action = this.getAttribute('data-action');
            switch(action) {
                case 'fechar-notif': fecharDropdownNotif(); break;
                case 'fechar-config': fecharDropdownConfig(); break;
                case 'fechar-perfil': fecharDropdownPerfil(); break;
                case 'sair-da-conta':
                    if (confirm('Tem certeza que deseja sair da conta?')) {
                        localStorage.removeItem('usuarioLogado');
                        window.location.href = '/home.html';
                    }
                    fecharDropdownPerfil();
                    break;
                default:
                    alert(`Funcionalidade '${action.replace('abrir-', '')}' ser√° implementada`);
                    fecharDropdownConfig(); 
                    fecharDropdownPerfil();
                    break;
            }
        });
    });
    
    document.addEventListener('click', event => {
        const isClickOutside = !dropdownNotif.contains(event.target) && event.target !== btnNotif &&
                               !dropdownConfig.contains(event.target) && event.target !== btnConfig &&
                               !dropdownPerfil.contains(event.target) && event.target !== fotoPerfilNav;
        
        if (isClickOutside) {
            fecharDropdownNotif();
            fecharDropdownConfig();
            fecharDropdownPerfil();
        }
    });

    // Adicionar estilos CSS inline para os status
    const style = document.createElement('style');
    style.textContent = `
        .status-aceito {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        .status-andamento {
            background: rgba(255, 165, 0, 0.2);
            color: #FFA500;
        }
        .status-concluido {
            background: rgba(33, 150, 243, 0.2);
            color: #2196F3;
        }
        .btn-marcar-concluido:hover {
            background: #45a049 !important;
            transform: scale(1.05);
            transition: all 0.3s;
        }
    `;
    document.head.appendChild(style);
});
    </script>
</body>
</html>